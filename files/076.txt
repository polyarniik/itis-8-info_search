<!DOCTYPE html>

<html data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D" lang="ru">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1.0,viewport-fit=cover,maximum-scale=1,user-scalable=0" name="viewport"/>
<meta content="unsafe-url" name="referrer"/>
<title>Немного о безопасности Kubernetes / Хабр</title>







<meta content="2.113.0" name="habr-version"/>
<meta content="444736788986613" data-vue-meta="ssr" property="fb:app_id"/><meta content="472597926099084" data-vue-meta="ssr" property="fb:pages"/><meta content="summary_large_image" data-vue-meta="ssr" name="twitter:card"/><meta content="@habr_com" data-vue-meta="ssr" name="twitter:site"/><meta content="Хабр" data-vmid="og:site_name" data-vue-meta="ssr" property="og:site_name"/><meta content="Немного о безопасности Kubernetes" data-vmid="og:title" data-vue-meta="ssr" property="og:title"/><meta content="Немного о безопасности Kubernetes" data-vmid="twitter:title" data-vue-meta="ssr" name="twitter:title"/><meta content="Немного о безопасности Kubernetes" data-vmid="aiturec:title" data-vue-meta="ssr" name="aiturec:title"/><meta content="Сегодняшняя статья будет посвящена обеспечению безопасности Kubernetes. Мы рассмотрим специфику защиты Kubernetes, и начнем мы с&amp;nbsp;рассмотрения вопросов безопасности контейнеров. Зло из контейнера..." data-vmid="description" data-vue-meta="ssr" name="description"/><meta content="Сегодняшняя статья будет посвящена обеспечению безопасности Kubernetes. Мы рассмотрим специфику защиты Kubernetes, и начнем мы с&amp;nbsp;рассмотрения вопросов безопасности контейнеров. Зло из контейнера..." data-vmid="description:itemprop" data-vue-meta="ssr" itemprop="description"/><meta content="Сегодняшняя статья будет посвящена обеспечению безопасности Kubernetes. Мы рассмотрим специфику защиты Kubernetes, и начнем мы с&amp;nbsp;рассмотрения вопросов безопасности контейнеров. Зло из контейнера..." data-vmid="og:description" data-vue-meta="ssr" property="og:description"/><meta content="Сегодняшняя статья будет посвящена обеспечению безопасности Kubernetes. Мы рассмотрим специфику защиты Kubernetes, и начнем мы с&amp;nbsp;рассмотрения вопросов безопасности контейнеров. Зло из контейнера..." data-vmid="twitter:description" data-vue-meta="ssr" name="twitter:description"/><meta content="Сегодняшняя статья будет посвящена обеспечению безопасности Kubernetes. Мы рассмотрим специфику защиты Kubernetes, и начнем мы с&amp;nbsp;рассмотрения вопросов безопасности контейнеров. Зло из контейнера..." data-vmid="aiturec:description" data-vue-meta="ssr" property="aiturec:description"/><meta content="https://habrastorage.org/getpro/habr/upload_files/f81/116/9fe/f811169fe0789fef6533dce759b672d2.png" data-vmid="image:itemprop" data-vue-meta="ssr" itemprop="image"/><meta content="https://habrastorage.org/getpro/habr/upload_files/f81/116/9fe/f811169fe0789fef6533dce759b672d2.png" data-vmid="og:image" data-vue-meta="ssr" property="og:image"/><meta content="1200" data-vmid="og:image:width" data-vue-meta="ssr" property="og:image:width"/><meta content="630" data-vmid="og:image:height" data-vue-meta="ssr" property="og:image:height"/><meta content="https://habrastorage.org/getpro/habr/upload_files/f81/116/9fe/f811169fe0789fef6533dce759b672d2.png" data-vmid="aiturec:image" data-vue-meta="ssr" property="aiturec:image"/><meta content="https://habrastorage.org/getpro/habr/upload_files/f81/116/9fe/f811169fe0789fef6533dce759b672d2.png" data-vmid="twitter:image" data-vue-meta="ssr" name="twitter:image"/><meta content="https://habrastorage.org/getpro/habr/upload_files/f81/116/9fe/f811169fe0789fef6533dce759b672d2.png?format=vk" data-vmid="vk:image" data-vue-meta="ssr" property="vk:image"/><meta content="718178" data-vmid="aiturec:item_id" data-vue-meta="ssr" property="aiturec:item_id"/><meta content="2023-02-21T14:10:29.000Z" data-vmid="aiturec:datetime" data-vue-meta="ssr" property="aiturec:datetime"/><meta content="https://habr.com/ru/company/otus/blog/718178/" data-vmid="og:url" data-vue-meta="ssr" property="og:url"/><meta content="article" data-vmid="og:type" data-vue-meta="ssr" property="og:type"/><meta content="ru_RU" data-vmid="og:locale" data-vue-meta="ssr" property="og:locale"/><meta content="kubernetes, docker" data-vue-meta="ssr" name="keywords"/>

<meta content="#303b44" name="apple-mobile-web-app-status-bar-style"/>
<meta content="#629FBC" name="msapplication-TileColor"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="yes" name="mobile-web-app-capable"/>
































</head>
<body>
<div data-async-called="true" data-server-rendered="true" id="app"><div class="tm-layout__wrapper"><!-- --> <div></div> <div class="tm-feature tm-feature"><!-- --></div> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><div class="tm-header__burger-nav"><button class="tm-header__button tm-header__button_burger" type="button"><svg class="tm-svg-img tm-header__icon tm-header__icon-burger" height="16" width="16"><title>Меню</title> <use xlink:href="/img/megazord-v28.2b11c25e..svg#header-burger"></use></svg></button></div> <span class="tm-header__logo-wrap"><a class="tm-header__logo tm-header__logo_ru" href="/ru/"><svg class="tm-svg-img tm-header__icon" height="16" width="16"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <!-- --> <div class="tm-header-user-menu tm-header_user-menu"><a class="tm-header-user-menu__item tm-header-user-menu__search" href="/ru/search/"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search" height="24" width="24"><title>Поиск</title> <use xlink:href="/img/megazord-v28.2b11c25e..svg#search"></use></svg></a> <!-- --> <!-- --> <!-- --> <div class="tm-header-user-menu__item"><button class="tm-header-user-menu__toggle" data-test-id="menu-toggle-guest"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_white" height="24" width="24"><title>Профиль</title> <use xlink:href="/img/megazord-v28.2b11c25e..svg#header-user"></use></svg></button> <!-- --></div> <!-- --></div></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <!-- --> <!-- --> <div class="tm-page-width"></div> <main class="tm-layout__container"><div class="tm-page" companyname="otus" data-async-called="true" hl="ru"><div class="tm-page-width"><div class="tm-page__header"><!-- --></div> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><!-- --> <div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg class="tm-svg-img pull-down__arrow" height="24" width="24"><title>Обновить</title> <use xlink:href="/img/megazord-v28.2b11c25e..svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet tm-article-snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a class="tm-user-info__userpic" href="/ru/users/Andrey_Biryukov/" title="Andrey_Biryukov"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_pink" height="32" width="32"><!-- --> <use xlink:href="/img/megazord-v28.2b11c25e..svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a class="tm-user-info__username" href="/ru/users/Andrey_Biryukov/">
      Andrey_Biryukov
      <!-- --></a> <span class="tm-article-datetime-published"><time datetime="2023-02-21T14:10:29.000Z" title="2023-02-21, 17:10">вчера в 17:10</time></span></span></span></div> <!-- --></div> <h1 class="tm-article-snippet__title tm-article-snippet__title_h1" lang="ru"><span>Немного о безопасности Kubernetes</span></h1> <div class="tm-article-snippet__stats"><!-- --> <div class="tm-article-reading-time"><span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Время на прочтение</title> <use xlink:href="/img/megazord-v28.2b11c25e..svg#clock"></use></svg></span> <span class="tm-article-reading-time__label">
    8 мин
  </span></div> <span class="tm-icon-counter tm-data-icons__item"><svg class="tm-svg-img tm-icon-counter__icon" height="24" width="24"><title>Количество просмотров</title> <use xlink:href="/img/megazord-v28.2b11c25e..svg#counter-views"></use></svg> <span class="tm-icon-counter__value">1.3K</span></span></div> <div class="tm-article-snippet__hubs-container"><div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a class="tm-article-snippet__hubs-item-link router-link-active" href="/ru/company/otus/blog/"><span>Блог компании OTUS</span> <!-- --></a></span><span class="tm-article-snippet__hubs-item"><a class="tm-article-snippet__hubs-item-link" href="/ru/hub/infosecurity/"><span>Информационная безопасность</span> <span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span></a></span><span class="tm-article-snippet__hubs-item"><a class="tm-article-snippet__hubs-item-link" href="/ru/hub/kubernetes/"><span>Kubernetes</span> <span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span></a></span></div></div> <!-- --> <!-- --> <!-- --></div></div> <!-- --> <div class="tm-article-body" data-gallery-root="" lang="ru"><div></div> <div id="post-content-body"><div><div class="article-formatted-body article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/856/6b3/c0e/8566b3c0edddf6bd0957062de980f651.png" height="439" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/856/6b3/c0e/8566b3c0edddf6bd0957062de980f651.png" width="780"/><figcaption></figcaption></figure><p>Сегодняшняя статья будет посвящена обеспечению безопасности Kubernetes. Мы рассмотрим специфику защиты Kubernetes, и начнем мы с рассмотрения вопросов безопасности контейнеров. </p><h2>Зло из контейнера</h2><p>Начнем с повторения базовых правил по обеспечению безопасности docker контейнеров. Прежде всего, конечно необходимо регулярно устанавливать обновления. Да, это та самая прописная истина, которую пишут в своих руководствах практически все разработчики ПО и железа. Однако, в контейнерах это требование приобретает несколько иной смысл. Дело в том, что в отличии от виртуализации, при использовании контейнеров используются функции ядра хостовой ОС. Так что, наличие уязвимости в контейнере по сути означает наличие уязвимости на хосте.</p><p>Также необходимо ограничивать доступ к сокету docker и не оставлять его без надлежащей защиты. Демон Docker использует сокет <code>/var/run/docker.sock</code> для входящих соединений API. Владельцем данного ресурса должен быть только пользователь root. По сути, предоставление прав доступа к сокету другому аккаунту означает предоставление этой учетке root доступа к хостовому узлу. </p><p>Также не стоит забывать о том, что в случае совместного использования сокета с контейнерами, компрометация <code>/var/run/docker.sock</code> приведет к захвату контроля над хостовой системой. Не стоит возлагать особые надежды на использование для сокетов read‑only mode, данный механизм не является надежной защитой от компрометации, и лучше все‑таки полностью отказаться от совместного использования сокетов с контейнерами.</p><p>И продолжая тему сетевой безопасности контейнеров напомним о еще одной рукотворной «дыре в защите». Docker TCP сокет открывает порт 2375 для HTTP и 2376 для HTTPS и позволяет полностью контролировать контейнеры, то есть по сути и хостовую систему тоже. </p><p>Разработка контейнеризированного приложения начинается с выбора подходящего образа, то есть с выбора дистрибутива и здесь важно выбрать не только подходящий по составу установленных пакетов и библиотек. Важно выбрать образ из надежного источника. Не стоит брать образы с каких‑то ресурсов с сомнительной репутацией, только потому, что этот образ содержит нужный набор библиотек.</p><p>Следующий важный момент при минимизации поверхности атаки это использование непривилегированного пользователя внутри контейнера. Архитектура разрабатываемого приложения должна основываться на принципе наименьших привилегий, в соответствии с которыми в частности в контейнере не должен использоваться привилегированный аккаунт. Если в Dockerfile не указано значение USER, то по умолчанию контейнер выполняется с использованием пользователя root. Поэтому можно при запуске контейнера указать флаг ‑u:</p><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/514/0e1/84c/5140e184c26f34b214626ec604393009.png" height="60" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/514/0e1/84c/5140e184c26f34b214626ec604393009.png" width="1207"/><figcaption></figcaption></figure><p>А лучше, конечно, в Dockerfile указать необходимого для работы пользователя:</p><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/503/c4d/63b/503c4d63b1f6bbee1650211eb9aa11a0.png" height="172" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/503/c4d/63b/503c4d63b1f6bbee1650211eb9aa11a0.png" width="817"/><figcaption></figcaption></figure><p>В чем опасность работы под root внутри контейнера? По умолчанию Docker запускает контейнеры от имени пользователя root. И когда это пространство имен затем сопоставляется с пользователем root в запущенном контейнере, это означает, что контейнер потенциально имеет root‑доступ на хосте Docker. </p><p>Также в продолжение темы, не запускайте контейнер с повышенными привилегиями. То есть не стоит использовать флаг ‑<code>privileged</code> при запуске контейнера:</p><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/43d/bf5/d1b/43dbf5d1bdd37ab4a6eafc3488e7e7e6.png" height="54" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/43d/bf5/d1b/43dbf5d1bdd37ab4a6eafc3488e7e7e6.png" width="1211"/><figcaption></figcaption></figure><h2>Нам не надо много</h2><p>Принцип минимизации поверхности атаки также означает и отсутствие ненужного функционала внутри контейнера. Необходимо ограничивать функции ядра для контейнера с помощью флагов cap‑drop и cap‑add. При этом принцип работы этих команд довольно прост: сначала отключаем все, а потом подключаем только то, что нам действительно нужно:</p><p><code>docker run --cap-drop=ALL --cap-add=MKNOD …</code></p><p>Также в рамках ограничения ненужного функционала не лишним будет отключение межконтейнерного взаимодействия. По умолчанию все контейнеры могут общаться посредством сети docker0. Для отключения этой нежелательной возможности воспользуемся флагом icc со значением false в файле Dockerfile: </p><p><code>DOCKER_OPTS=”--icc=false”</code> </p><p>Ну и не надо быть слишком жадными и требовать неограниченного числа ресурсов. Ограничить ресурсы контейнеров можно с помощью флагов <code>--memory</code> и <code>--memory-swap</code> для памяти и cpus, cpuset‑cpus для процессора. </p><p>Например:</p><p><code>docker run -it --memory="1g" ubuntu</code></p><p><code>docker run -it --cpus="1.0" ubuntu</code></p><p>И заканчивая тему ограничений для контейнеров, не лишним будет (если позволяет архитектура контейнеризируемого приложения) использовать read only файловую систему и Volume:</p><p><code>docker run --read-only alpine</code></p><p><code>docker run -v volume-name:/path/in/container:ro alpine</code></p><h2>Сканер контейнеров</h2><p>Кроме вышеперечисленных мер, обязательно необходимо проверить образ на наличие пропатченных уязвимостей. Не должно быть незакрытых дыр, то есть уязвимых сервисов и библиотек. Для проверки можно использовать различные сканеры уязвимостей (trivy, clair…).</p><p>Мы воспользуемся наиболее распространенным решением — плагином docker scan. Для сканирования необходимо сначала установить плагин а затем запустить процесс сканирования: </p><p><code>$ apt-get update &amp;&amp; apt-get install docker-scan-plugin</code></p><p><code>$ docker scan имя_образа</code></p><p>В результате получаем отчет следующего вида:</p><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/f07/29a/59d/f0729a59d12a7a26a981ac54e9f39d6b.png" height="742" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/f07/29a/59d/f0729a59d12a7a26a981ac54e9f39d6b.png" width="1212"/><figcaption></figcaption></figure><h2>Подпись</h2><p>В идеале для того, чтобы предотвращения различных атак используемый образ должен быть подписан. Включить проверку подписи контейнеров можно с помощью команды</p><p><code>export DOCKER_CONTENT_TRUST=1</code></p><p>Тогда если вы попытаетесь запустить неподписанный образ, ваш запрос будет отклонен.</p><p>На этом тему безопасности Docker контейнеров предлагаю считать исчерпанной, основные моменты мы рассмотрели, а для более тонкой настройки контейнеров предлагаю обратиться к документации вендора. И перейдем рассмотрению механизмов безопасности самого kubernetes.</p><h2>Admission Controllers</h2><p> Admission controllers — это специальные плагины в Kubernetes, предназначенные для перехвата запросов к серверу API Kubernetes до того момента, когда объект будет сохранен, с целью проверки подлинности и авторизации запроса.</p><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/8fb/c5c/074/8fbc5c07485af7ca54ec8e2c3448c836.png" height="423" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/8fb/c5c/074/8fbc5c07485af7ca54ec8e2c3448c836.png" width="1203"/><figcaption></figcaption></figure><p>В целом, концепция Admission controllers состоит из следующих основных этапов:</p><ul><li><p>API HTTP handler</p></li><li><p>Authentification/Authorization</p></li><li><p>Mutating admission (mutating webhooks)</p></li><li><p>Schema validation</p></li><li><p>Validating admission (validating webhooks)</p></li><li><p>Persisted to etcd</p></li></ul><p>По сути, когда на API приходит запрос, затем уже на сервере KubeAPI происходит аутентификация и авторизация, далее происходит проверка данных и схемы с помощью веб хуков, и только потом запись идет в хранилище etcd. Таким образом, мы прежде всего проверяем какие данные нам передали, нет ли в них чего‑то не слишком безопасного в плане создания контейнера, а также мы можем изменить потенциально небезопасные значения параметров если они не соответствуют правилам безопасности. </p><p>Включение admission controller»ов может происходить посредством отправки флага напрямую kubeapi‑server:</p><p><code>--enable-admission-plugins=ValidatingAdmission Webhook,MutatingAdmissionWebhook</code></p><p>В текущих версиях Kubernetes несколько Admission Controller уже включены по умолчанию и обеспечивают базовый уровень безопасности. Kubernetes советует использовать следующие admission controller по умолчанию:</p><p><code>--enable-admission-plugins=NamespaceLifecycle,imitRanger,ServiceAccount,</code></p><p><code>DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,Priority,ResourceQuota,PodSecurityPolicy</code></p><p>Отдельно хотелось бы обратить внимание использование mutating/validating webhooks. С помощью валидирующих и модифицирующих вебхуков, можно внедрить запрет запуска пода под повышенными привилегиями. При попытке развернуть под с повышенными привилегиями мы получим ошибку, и такой под не будет развернут. </p><p>Например, мы можем при развертывании указать <code>runAsNonRoot</code>, но далее установить <code>runAsUser = 0</code>. В результате предполагается запуск под root. Однако, вебхук может обнаружить подобную попытку обхода запрета и не дать запустить контейнер.</p><p>Таким образом, Admission controllers могут повысить безопасность, установив разумный базовый уровень безопасности для namespace или всего кластера.</p><p>Встроенный PodSecurityPolicy admission controller можно использовать, например для запрета запуска контейнеров под root или обеспечения того, чтобы корневая файловая система контейнера всегда монтировалась только для чтения. То есть, реализовать тот самый функционал, о котором мы говорили в разделе, посвященном безопасности контейнеров. Также можно разрешить извлечение образов только из определенных реестров, известных разработчиков. Не позволять загружать контейнеры откуда попало.</p><p>С помощью PodSecurityPolicy можно отклонять развертывания, не соответствующие стандартам безопасности. Например, контейнеры, использующие privileged флаг, могут обойти множество проверок безопасности</p><p>Помимо выполнения задач связанных с безопасностью, Admission controllers позволяют проверять конфигурацию объектов, работающих в кластере, и предотвращают попадание каких‑либо очевидных неправильных конфигураций в ваш кластер.</p><p>Admission controllers могут также быть полезны для обнаружения и исправления образов, развернутых без семантических тегов, например, при автоматическом добавлении или проверке лимитов ресурсов, автоматическом добавление меток и аннотаций, а также для проверки того, чтобы ссылки на образы, используемые в продакшен развертываниях, не использовали latest‑теги или теги с ‑dev‑суффиксом. Использование таких тегов чревато тем, что у нас окажется нестабильная версия контейнера со всеми вытекающими последствиями в части безопасности и надежности.</p><h2>Безопасность в Run-Time</h2><p>На смену устаревшей PodSecurityPolicy в версии 1.22 пришел контроллер доступа Pod Security Admission controller (PSA). Данный контроллер определяет стандарты безопасности pod на уровне пространства имен (namespace). После активации PSA (или установки вебхука) вы можете настроить пространства имен, чтобы определить режим контроля доступа, который вы хотите использовать. </p><p>Kubernetes определяет набор режимов, которые вы можете установить, чтобы определить, какой из предопределенных уровней безопасности Pod Standard вы хотите использовать для неймспейсов. Выбранная вами метка определяет, какое действие предпринимает k8s при обнаружении потенциального нарушения. Набор режимов, которые можно установить в PSA:</p><ul><li><p><strong>Enforce</strong> — Нарушения правил приведут к отклонению развертывания.</p></li><li><p><strong>Audit</strong> — Нарушения политики вызывают добавление аннотации аудита к событию, записанному в журнале аудита (audit log), но в остальном они разрешены.</p></li><li><p><strong>Warn</strong> — Нарушения политики вызовут предупреждение для пользователя, но в остальном разрешены.</p></li></ul><p>Для подов имеются три политики от наименее запретительной к наиболее.</p><ul><li><p><strong>Privileged</strong> — все открыто и неограниченно.</p></li><li><p><strong>Baseline</strong> — охватывает наиболее распространенные известные повышения привилегий и обеспечивает более легкую адаптацию.</p></li><li><p><strong>Restricted</strong> — строго ограниченно, в соответствии с лучшими практиками. Может вызвать проблемы с совместимостью.</p></li></ul><p>Политики применяются к пространству имен с помощью меток. Эти метки следующие:</p><p><code>REQUIRED: pod-security.kubernetes.io/&lt;MODE&gt;: &lt;LEVEL&gt;</code></p><p><code>OPTIONAL: pod-security.kubernetes.io/&lt;MODE&gt;-version: &lt;VERSION&gt; (defaults to latest)</code></p><p>Для того, чтобы оценить существующие рабочие нагрузки на соответствие политикам и определить, какие рабочие нагрузки необходимо будет изменить, чтобы они не нарушали политику, можно воспользоваться следующей командой.</p><p><code>kubectl label --dry-run=server --overwrite ns --all \</code></p><p><code>    pod-security.kubernetes.io/enforce=baseline</code></p><p> </p><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/34b/8aa/481/34b8aa48147b3b7111071aad10277096.png" height="223" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/34b/8aa/481/34b8aa48147b3b7111071aad10277096.png" width="971"/><figcaption></figcaption></figure><p>Далее в зависимости от развернутых контейнеров мы можем получить различные результаты. </p><h2>Заключение</h2><p>В этой статье мы рассмотрели основные моменты обеспечения безопасности Kubernetes, начиная от безопасной настройки контейнеров и заканчивая настройками политик. За рамками статьи остались темы связанные с безопасной настройкой сети и приложений, а также etcd и многое другое. В следующих статьях мы еще вернемся к этой теме. </p><p>А прямо сейчас приглашаю вас на <a href="https://otus.pw/4sgj/">бесплатный урок</a>, где мы изучим тонкости архитектурного устройства kubernetes, поговорим о концепциях data и control plane и подробнее остановимся на ключевом компоненте — etcd и алгоритме консенсуса raft.</p><ul><li><p><a href="https://otus.pw/4sgj/">Зарегистрироваться на бесплатный урок</a></p></li></ul><p></p></div></div></div> <!-- --> <!-- --></div> <!-- --> <!-- --></div> <!-- --> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bkubernetes%5D">kubernetes</a></li><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bdocker%5D">docker</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a class="tm-hubs-list__link router-link-active" href="/ru/company/otus/blog/">Блог компании OTUS</a></li><li class="tm-separated-list__item"><a class="tm-hubs-list__link" href="/ru/hub/infosecurity/">Информационная безопасность</a></li><li class="tm-separated-list__item"><a class="tm-hubs-list__link" href="/ru/hub/kubernetes/">Kubernetes</a></li></ul></div></div></article></div> <!-- --></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon tm-votes-meter__icon_appearance-article" height="24" width="24"><title>Всего голосов 10: ↑10 и ↓0</title> <use xlink:href="/img/megazord-v28.2b11c25e..svg#counter-rating"></use></svg> <span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating" title="Всего голосов 10: ↑10 и ↓0">+10</span></div> <div class="v-portal" style="display:none;"></div></div> <!-- --> <!-- --> <button class="bookmarks-button tm-data-icons__item" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v28.2b11c25e..svg#counter-favorite"></use></svg></span> <span class="bookmarks-button__counter" title="Количество пользователей, добавивших публикацию в закладки">
    32
  </span></button> <div class="tm-article-comments-counter-link tm-data-icons__item" title="Читать комментарии"><a class="tm-article-comments-counter-link__link" href="/ru/company/otus/blog/718178/comments/"><svg class="tm-svg-img tm-article-comments-counter-link__icon" height="24" width="24"><title>Комментарии</title> <use xlink:href="/img/megazord-v28.2b11c25e..svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      0
    </span></a> <!-- --></div> <div class="tm-sharing tm-data-icons__item" title="Поделиться"><button class="tm-sharing__button" type="button"><svg class="tm-sharing__icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z" fill="currentColor"></path></svg></button> <div class="v-portal" style="display:none;"></div></div> <div class="v-portal" style="display:none;"></div></div> </div></div> <div class="v-portal" style="display:none;"></div> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!-- --> <div></div> <section class="tm-block tm-block tm-block_spacing-bottom"><!-- --> <div class="tm-block__body tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a class="tm-company-snippet__logo-link" href="/ru/company/otus/profile/"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="40" src="//habrastorage.org/getpro/habr/company/2d5/0ed/b57/2d50edb57cf45fa07cc4f39f53b78395.png" width="40"/></div></a> <div class="tm-company-snippet__info"><a class="tm-company-snippet__title" href="/ru/company/otus/profile/">OTUS</a> <div class="tm-company-snippet__description">Цифровые навыки от ведущих экспертов</div></div></div> <div class="tm-article-author__buttons"><!-- --> <!-- --></div></div> <div class="tm-article-author__company-contacts"><a class="tm-article-author__contact" href="https://otus.ru" rel="noopener" target="_blank">
      Сайт
    </a><a class="tm-article-author__contact" href="https://vk.com/club145052891" rel="noopener" target="_blank">
      ВКонтакте
    </a><a class="tm-article-author__contact" href="https://telegram.me/Otusjava" rel="noopener" target="_blank">
      Telegram
    </a></div> <div class="tm-article-author__separator"></div></div> <div class="tm-user-card tm-article-author__user-card tm-user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a class="tm-user-card__userpic tm-user-card__userpic_size-40" href="/ru/users/Andrey_Biryukov/"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_pink"><!-- --> <use xlink:href="/img/megazord-v28.2b11c25e..svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div class="tm-counter-container tm-karma tm-karma" title=" 37 голосов "><div class="tm-counter-container__header"><div class="tm-karma__votes tm-karma__votes_positive">
      9
    </div></div> <div class="tm-counter-container__footer"><div class="tm-karma__text">
      Карма
    </div> <div class="v-portal" style="display:none;"></div></div></div> <div class="tm-counter-container" title="Рейтинг пользователя"><div class="tm-counter-container__header"> <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!-- --> <div class="tm-votes-lever__score tm-votes-lever__score tm-votes-lever__score_appearance-rating"><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter tm-votes-lever__score-counter_rating">
        106
      </span></div> <!-- --></div></div> <div class="tm-counter-container__footer"><span class="tm-rating__text tm-rating__text">
      Рейтинг
    </span></div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title tm-user-card__title_variant-article"><!-- --> <a class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article" href="/ru/users/Andrey_Biryukov/">
          @Andrey_Biryukov
        </a> <!-- --></div> <p class="tm-user-card__short-info tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons tm-user-card__buttons_variant-article"><!-- --> <!-- --> <!-- --> <!-- --> <!-- --></div></div> <!-- --></div> <div class="v-portal" style="display:none;"></div></div> <!-- --></section> <!-- --> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style" href="/ru/company/otus/blog/718178/comments/"><svg class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted" height="24" width="24"><title>Комментарии</title> <use xlink:href="/img/megazord-v28.2b11c25e..svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментировать 
    </span></a> <!-- --></div></div></div> <section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header tm-block__header_variant-borderless"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2> </div> <!-- --></header> <div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim"><div class="tm-tabs tm-tabs"><div><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim">
        Лучшие за сутки
      </button></span><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_slim">
        Похожие
      </button></span></div> <!-- --></div> <div class="similar-and-daily__tab-view"><div><!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <div class="tm-placeholder-article-cards"><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div></div> <!-- --> <!-- --> <!-- --> <!-- --></div> <!-- --></div></div> <!-- --></section> <div><!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <div class="tm-placeholder-inset tm-placeholder-vacancies"><div class="tm-placeholder-inset__header"><div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div></div> <div class="tm-placeholder-inset__body"><ul class="tm-placeholder-list"><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li></ul></div> <div class="tm-placeholder-inset__footer"><div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div></div></div> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --></div> <!-- --> </div></div></div></div></div> <div class="tm-page__sidebar"><!-- --></div></div></div></div></main> <!-- --></div> <!-- --> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><div class="tm-footer__title"><a class="tm-svg-icon__wrapper tm-footer__title-link router-link-active" href="/ru/"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a></div> <div class="tm-footer__social"><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <div class="v-portal" style="display:none;"></div> <button class="tm-footer__link"><svg class="tm-svg-img tm-footer__icon" height="16" width="16"><title>Язык</title> <use xlink:href="/img/megazord-v28.2b11c25e..svg#lang"></use></svg>
        Настройка языка
      </button> <a class="tm-footer__link" href="/ru/feedback/">
        Техническая поддержка
      </a> <a class="tm-footer__link" href="/berserk-mode-nope">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2023, </span> <span class="tm-copyright__name"><a class="tm-copyright__link" href="https://company.habr.com/" rel="noopener" target="_blank">Habr</a></span></span></div></div></div></div> <!-- --> <!-- --></div> <div class="vue-portal-target"></div></div>








</body>
</html>
